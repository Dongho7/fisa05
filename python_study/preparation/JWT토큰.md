# JWT 토큰
---
인증(authentication)과 인가(authorization) 
인증은 사용자의 신원을 확인하는 절차.
인가는 인증된 사용자가 특정 자원이나 기능에 접근할 수 있는 권한을 부여받는 절차.

클라이언트-서버 모델의 기본 구조
현대 웹은 대부분 클라이언트-서버 모델로 동작.

사용자의 웹 브라우저가 서버에 요청을 보내면 서버는 그에 대한 응답을 생성하여 다시 클라이언트로 보낸다. 

중요한 특징으로 HTTP통신은 기본적으로 stateless(무상태)이다. 즉, 서버가 이전 요청의 상태(누가 요청했는지 등)을 지속적으로 기억하지 않습니다. 
이는 서버 확장에 유리하다(한 사용자의 연속적인 요청이 항상 같은 서버로 가지 않아도 되므로..)
다만, 무상태 특성 때문에 매 요청마다 클라이언트의 신원을 확인할 수 없는 단점도 있다. 그래서, 이 문제를 해결하기 위해 쿠키와 세션과 같은 기술이 필요합니다. 

**HTTP 요청/응답과 세션과 쿠키의 개념과 한계**
HTTP는 웹에서 클라이언트-서버 간에 정보를 주고받는 프로토콜로, 앞서 언급했듯 무연결성과 무상태성이 특징입니다. 

**쿠키**:  쿠키는 서버가 클라이언트에 저장시키는 작은 키-값 데이터다. 서버는 첫 로그인 응답 시에 set-cookie 헤더에 어떤 정보를 넣어 클라이언트에 보내고 클라이언트 브라우저는 이를 저장합니다. 

이후, 클라이언트는 같은 서버에 요청을 보낼 때마다 해당 쿠키를 요청 헤더에 담아 보내고 서버는 쿠키 정보를 보고 어떤 클라이언트의 요청인지 식별할 수 있습니다. 

이때 주로 **세션ID나 인증 토큰** 같은 최소한의 정보만 쿠키에 담습니다.
단점도 있습니다. 쿠키 값이 클라이언트 측에 노출되므로, 변조나 탈취에 취약하고 몯느 요청마다 쿠카기 전송되므로, 네트워크 부하가 추가된다. 

**세션:** 세션은 쿠키와 함께 쓰이는 개념으로, 인증 상태를 서버 측에 저장하는 방식입니다. 사용자가 로그인하면 서버는 해당 ㅏㅅ용자에 대한 세션 데이터를 메모리나 DB에 저장하고, **그 식별자(session ID)**를 쿠키로 클라이언트에 전달합니다. 이후, 클라이언트는 매 요청마다 이 세션 ID가 담긴 쿠키를 보내고, 서버는 세션 저장소에서 ID에 해당하는 데이터를 찾아 인증 여부를 확인합니다. 

장점으로는, 서버가 세션을 직접 관리하므로 서버 측에서 통제가 가능하다. 하지만, 서버 메모리/DB 자원이 지속적으로 소비된다. 
요컨데 세션 기반 인증은 상태를 서버가 기억해야 하므로, 확장성이나 장애 대응 츠겸ㄴ에서 부담이 있다. 
***HTTP 위에 상태 유지 메커니즘을 올린 것이 쿠키/세션***

---
**JWT 토큰의 정의와 등장 배경**
JWT는 JSON 포멧으로 인코딩된 토큰으로 인증에 필요한 정보를 자체적으로 포함하고 있고, 전자 서명을 통해 위변조를 방지하는 토큰 기술.

사용자 인증 정보와 권한 등의 클레임을 담은 JSON 데이터를 Base64로 인코딩한 문자열이고, 그 문자열에 서버만 알고 있는 키로 만든 서명을 붙여 토큰의 진위와 무결성을 검증 

기존의 토큰/세션 방식은 사용자가 급증할 경우 확장성이 떨어지지만, JWT는 토큰 한 개에 필요한 정보를 모두 담아 클라이언트에게 전달하고, 이후로는 서버가 검증절차만 거치면 되므로 서버 부하를 낮출 수 있다. 

**JWT의 구조**
JWT토큰읜 세 부분으로 구성, 마침표로 구분. 
Header, Payload, Signature 세 가지 부분. 
(JWT는 인코딩된 것이지 암호화된 것이 아니므로, 누구나 헤더와 페이로드를 볼 수 있다. 따라서 민감한 정보 JWT 안 됨)

마지막으로 Signature는 헤더와 페이로드를 서버의 비밀 키로 해싱하여 생성된 전자서명으로, 토큰이 발급자에 의해 올바르게 서명되었는지 검증하는 데 사용됩니다
header에는 signature에 사용된 알고리즘이 적혀있다. payload는 본문 내용으로, 사용자에 대한 속성들이 클레임 형태로 포함된다. 가령, 만료시간, 발급시간과 같은 표준 클레임과, 애플리케이션 필요에 따라 설정한 커스텀 클레임(user_id, role 등)

시그니처는 비밀 키를 가진 주체만이 생성 가능 
JWT가 헤더/페이로드를 보내면, 서버가 비밀 키로 다시 해싱하여 토큰의 진위 검증 


